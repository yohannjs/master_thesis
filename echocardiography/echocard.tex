\chapter{Myocardial Imaging and Echocardiography} \label{chap:strain}
\begin{comment}
[ ] Short about cardiology and echocardiography history
[ ] Short about the heart, and its anatomy
[ ] Even shorter about ultrasound, the different views, and what parts of the heart can be seen in them.
[ ] Method for extracting strain curves from ultrasound videos.
[ ] Explain the different diagnosises that will be encountered in this thesis.
[ ] Explain anatomical reasoning for why symptoms for certain diagnosis are evident in strain curves.
[ ] Summarize chapter
\end{comment}

This chapter will describe the basic structure of the heart muscle, give an introduction to ultrasound imaging and echocardiography, explain how longitudinal strain curves and \acrfull{ef} are estimated and give the definition of the different types of heart failure and myocardial infarction encountered in this work. The theory in this chapter on ultrasound imaging, and echocardiography is largely based on the work of Asbjørn Støylen provided in his website ''Strain rate imaging''\footnote{http://folk.ntnu.no/stoylen/strainrate/} which is a collection of online articles on the physics and technology behind ultrasound imaging as used in echocardiography. The different online articles are referred to individually as separate works, to make it easier to find the exact source of the citation.

\section{Basic Cardiology}
\begin{comment}
[ ] Short about cardiology and echocardiography history
[ ] Short about the heart, and its anatomy
\end{comment}

The heart is an autonomous muscle that is responsible for pumping oxygenated blood from the lungs, into the rest of the body and pumping unoxygenated blood from the rest of the body, into the lungs. The heart can be divided into four separate chambers: The right atrium, the left atrium, the right ventricle and the left ventricle. The right chambers are responsible for pumping unoxygenated blood from the body into the lungs, while the left chambers are responsible for pumping oxygenated blood from the lungs into the rest of the body. In both the right, and left chambers the blood flows first through the atria, and then through the ventricles before exiting the heart. One heart cycle is the time period it takes the heart muscles to make a full contraction and relaxation. The period of the heart cycle where the heart relaxes, and fills with blood is called the \textit{diastole}, and the period of the heart cycle when the heart contracts and pumps blood throughout the body is called the \textit{systole}. Cardiology is the branch of medicine that deals with the heart, and parts of the vascular system \cite{cardiology_wikipedia}. Cardiologists are doctors that specialize in the field of cardiology. Echocardiography is a diagnostic tool used in cardiology to make images of muscle tissue in the heart called myocard, using ultrasound technology. 

\section{Introduction to Ultrasound Imaging and Echocardiography}
\begin{comment}
[ ] Even shorter about ultrasound, the different views, and what parts of the heart can be seen in them.
\end{comment}

Ultrasound imaging is a diagnostic tool that is popular because it can give videos in real-time, it is relatively inexpenisve and has a lower associated health-risk compared to imaging alternatives \cite{medical_ultrasound_wikipedia}. In this section \textit{two dimensional B-mode ultrasound imaging} will be detailed, where the \textit{B} stands for \textit{brightness}. The frequency of the sound waves used in ultrasound imaging are in the range of 1 - 12 MHz, and the frequency chosen for wave pulses will decide the size of the objects that the method is able to resolve \cite{basic_ultrasound}. Ultrasound imaging works by emitting pulses of ultrasound waves at myocardial tissue, the pulses are partially reflected by the different tissue structures, and are then sampled by a receiver upon return the the source that transmitted them, as illustrated in figure \ref{fig:us_reflect}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.99\textwidth]{echocardiography/US_reflection.png}
    \caption{An illustration of how ultrasound pulses are partially reflected by many barriers of tissue. The horisontal arrows represent the pulses, where the relative sizes represent the amplitude of the pulse, and the vertical lines represent different structures of tissue. The figure is inspired by figure 2 in \cite{basic_ultrasound}.}
    \label{fig:us_reflect}
\end{figure}

Sound waves will have different velocities depending of what medium it is travelling in. This ratio of velocities in the different mediums is what decides what amount of an incident wave is reflected when it hits a transition between two mediums. Since the velocities of the ultrasound waves in different mediums are known, and the time it takes for a transmitted pulse to return can be measured, one is able to calculate the distance to the tissue structure that reflected the transmitted pulse using equation \eqref{eq:dist}. 

\begin{equation}
    \mathrm{distance} = \frac{\mathrm{time}}{2 \times \mathrm{velocity}}
    \label{eq:dist}
\end{equation}

By plotting the intensity of the reflected pulses as a function of the distance to the point from which they are reflected, one gets what is called a \textit{B-mode line}. Images created by two dimensional ultrasound imaging are polar plots of several B-mode lines that together make up a two dimensional intersectional image of a tissue structure. The procedure consists of emitting a pulse, creating a B-mode line by the sampled reflections, rotating the transmitter, and repeating. This procedure is illustrated in figure \ref{fig:b_mode_search}.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.99\textwidth]{echocardiography/b_mode_search.png}
    \caption{Illustration of how a two dimensional ultrasound image is put together by several individual B-mode lines. This figure is inspired by the graphical illustrations in figure 7 in \cite{basic_ultrasound}.}
    \label{fig:b_mode_search}
\end{figure}

The specific method of echocardiography used to collect the data used in this thesis is called transthoracic echocardiography. In this method ultrasound images are produced by sending ultrasound waves through the ribs of a patient, from outside the body by locating the transmitter-receiver on the chest of the patient. The transthoracic echocardiography method is constricted by the ribs such that thera are only three intersectional images that can be extracted of the heart. These three intersections are referred to as \textit{views}, and the corresponding terms are the \acrfull{4ch} view, \acrfull{2ch} view and the \acrfull{aplax} view, and examples of ultrasound images in all three views are given in figure \ref{fig:us_view_examples}.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.3\textwidth} 
        \includegraphics[width=0.99\textwidth]{echocardiography/4ch_frame.png}
        \caption{\acrshort{4ch}}
        \label{fig:us_view_examples_4ch}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=0.99\textwidth]{echocardiography/2ch_frame.png}
        \caption{\acrshort{2ch}}
        \label{fig:us_view_examples_2ch}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=0.99\textwidth]{echocardiography/aplax_frame.png}
        \caption{\acrshort{aplax}}
        \label{fig:us_view_examples_aplax}
    \end{subfigure}
    \caption{Examples of ultrasound images taken from the three views: (a) \acrfull{4ch}, (b) \acrfull{2ch} and (c) \acrfull{aplax}. Note that these images are flipped vertically because the ultrasound images are taken from below the heart.}
    \label{fig:us_view_examples}
\end{figure}

It is commonplace among clinicians to focus on the state of health of the left ventricle of the heart. In clinical procedure the left ventricle is divided into 16, 17 or 18 segments. This work will follow the 18-segment model, as that is the model chosen by the clinician who has annotated the images. Figure \ref{fig:18_segment_model} illustrates the 18 different segments of the left ventricle, and how they can be seen in the different views. The names of the different segments are shown in table \ref{tab:segment_names}, where the segment numbers correspond to the numbers in figure \ref{fig:18_segment_model}. When referring to the entire intersection of the left ventricle that is visible from a particular view, it will be refered to as the \textit{global segment}.

\begin{table*}
    \centering
    \ra{1}
    \begin{tabular}{cc}
        \toprule
        Segment nr. & Segment name \\
        \midrule
        1           & Basal Septal  \\
        2           & Mid Septal  \\
        3           & Apical Septal  \\
        4           & Apical Lateral  \\
        5           & Mid Lateral  \\
        6           & Basal Lateral  \\
        7           & Basal Inferior  \\
        8           & Mid Inferior  \\
        9           & Apical Inferior  \\
        10          & Apical Anterior  \\
        11          & Mid Anterior  \\
        12          & Basal Anterior  \\
        13          & Basal Posterior  \\
        14          & Mid Posterior  \\
        15          & Apical Posterior  \\
        16          & Apical Anteroseptal  \\
        17          & Mid Anteroseptal  \\
        18          & Basal Anteroseptal  \\
        \bottomrule
    \end{tabular}
    \caption{A table matching the segment numbers shown in figure \ref{fig:18_segment_model}, with the segment name.}
    \label{tab:segment_names}
\end{table*}

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.3\textwidth} 
        \includegraphics[width=0.99\textwidth]{echocardiography/4ch_frame_segmented.png}
        \caption{\acrshort{4ch}}
        \label{fig:18_segment_model_4ch}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=0.99\textwidth]{echocardiography/2ch_frame_segmented.png}
        \caption{\acrshort{2ch}}
        \label{fig:18_segment_model_2ch}
    \end{subfigure}
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=0.99\textwidth]{echocardiography/aplax_frame_segmented.png}
        \caption{\acrshort{aplax}}
        \label{fig:18_segment_model_aplax}
    \end{subfigure}
    \caption{An illustration of the 18-segment model of the heart. It shows which segment can be seen in which view. Like in figure \ref{fig:us_view_examples} the images are flipped vertically. Note that the boundaries drawn on the figure are only meant to be illustrative, and are not the actual boundaries of the regional segments.}
    \label{fig:18_segment_model}
\end{figure}

\section{Myocardial Strain Estimation and Ejection Fraction}
\begin{comment}
[ ] Method for extracting strain curves from ultrasound videos.
[ ] Examples of GLS and RLS
[ ] Define the peak systolic strain used in this work
[ ] Define Ejection fraction
\end{comment}

Strain is a relative measure of deformation, of physical objects. Since strain is relative it has no unit, and is measured in percentages in this work. The concept of strain is complex, and is well established in other scientific fields such as structural engineering. When estimating strain of linear segments, one can use the Lagrangian formula defined in \eqref{eq:linear_strain} \cite{basic_concepts}. Let $L_r$ be the length of the segment at the reference time, let $t$ be the time one wishes to measure the strain at, let the length of the segment at $t$ be denoted $L_t$ and $\epsilon(t)$ be the strain.

\begin{equation}
    \epsilon(t) = \frac{L_t - L_r}{L_r}
    \label{eq:linear_strain}
\end{equation}

This work will primarily be concerned with longitudinal strain of segments in the left ventricle. Longitudinal strain occurs due to changes in the length of a myocard segment. The two other types of strain that can be calculated with two dimensional echocardiography are transmural strain which is due to changes in the thickness of the myocard and circumferential strain which are due changes in the circumference of the entire structure \cite{basic concepts}. To estimate the strain of a particular segment, one must first define the boundaries of all the segments. There are many ways of doing this, but the most accurate method is for a clinician to draw the segment borders by hand. The clinician that annotated the dataset used in this work segmented the images using the commercial tool ECHOPAC which is developed by GE HealthCare\footnote{https://www.gehealthcare.com/products/ultrasound/vivid/echopac}. The longitudinal strain of a segment is then the relative difference in length of a segment in image frame $t$ compared to a reference image. The length of a segment is illustrated with the centerline of the vertical segment borders in figure \ref{fig:strain_estimation}. The centerline is highlighted in red in figure \ref{fig:gls_estimation}, and blue in \ref{fig:rls_estimation}. As strain is a relative measure, one needs to define a reference length which the other strain values are calculated with regard to. This could be the length of the segment during the first frame, the length of the segment when it is at its longest, the length of the segment when it is at its shortest or the length of the segment in any other ultrasound image. The strain of a segment in the reference image will then be $0\%$, and the strain of the segment in the other images will be a percentage relative to the reference image.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.49\textwidth} 
        \includegraphics[width=0.99\textwidth]{echocardiography/gls_estimation.png}
        \caption{\acrshort{gls} estimation}
        \label{fig:gls_estimation}
    \end{subfigure}
    \begin{subfigure}[b]{0.49\textwidth}
        \includegraphics[width=0.99\textwidth]{echocardiography/rls_estimation.png}
        \caption{\acrshort{rls} estimation}
        \label{fig:rls_estimation}
    \end{subfigure}
    \caption{Illustration meant to assist in the understanding of what longitudinal strain is. Note that the segment borders drawn on these images are only illustrative, and are not the actual segment borders used to estimate the strain. (a) shows the strain estimation of the global segment, and (b) shows the strain estimation of the regional segments.}
    \label{fig:strain_estimation}
\end{figure}

The IMPROVE dataset included computed strain curves, but it remains unclear exactly how they were computed. There are multiple ways of computing the strain of a segment, for example the tissue Doppler and speckle tracking methods. As the name implies the the tissue Doppler method, utilizes the Doppler effect. The Doppler effect can be concisely summarized by stating that when a wave is reflected by an object that has a velocity component that is radial with regard to the direction of the wave propagation, the frequency of the reflected wave will changed with regard to the incident wave. The frequency will increase if the direction of the radial velocity component is opposite from the wave propagation direction, and it will decrease if the radial velocity component is in the same direction as the wave propagation. The magnitude of the frequency change can then be used to estimate the velocity of the moving object. Tissue Doppler then estimates the radial velocities of partitions of tissue to create a vector field of velocities \cite{strain_rate_imaging}. There are different ways of calculating strain from the velocity field, one option is to integrate the velocity field to track the displacement of the tissue partitions, but a method that requires less computation is to estimate the strain rate using equation \eqref{eq:strain_rate} \cite{myocardial_imaging}. Here $v_1$ and $v_2$ are the instantaneous velocities of the tissue partitions, and $\Delta x$ is a constant length. Strain is then estimated by integrating the strain rate over the total duration of the deformation. 

\begin{equation}
    \frac{\partial \epsilon}{\partial t} = \frac{v_2 - v_1}{\Delta x}
    \label{eq:strain_rate}
\end{equation}

The speckle tracking method is based on the fact that the spatial distribution of grey spots in an ultrasound image is inherently random. Specific regions of grey spots are referred to as speckle patterns, and each speckle pattern is unique. Since the speckle patterns are unique, their displacement can be tracked from one frame of the ultrasound video to another \cite{myocardial_imaging}. By then using the recorded longitudinal displacements of speckle patterns within a segment and equation \eqref{eq:linear_strain}, one can estimate the longitudinal strain of a segment.

By collecting all the strain values of a segment from the different ultrasound images into a time series, one gets a \textit{strain curve}. If the strain curve consists of strain values estimated from a global segment as depicted in figure \ref{fig:gls_estimation}, the curve is called a \acrfull{gls} curve. If the strain values are estimated from one of the six regional segments, as depicted in figure \ref{fig:rls_estimation}, the curves are called \acrfull{rls} curves. In diagnostic procedure it is common to extract specific values from the longitudinal strain curves. Typical strain values extracted are the peak value during the systole, the peak value during the diastole, trough values during the systole and trough values during the diastole. Figure \ref{fig:pss_illustration} shows what a typical longitudinal strain curve looks like. The peak and trough strain values during systole are illustrated by blue dots on the strain curve. The peak and trough strain values during diastole are illustrated by red dots on the strain curve. The colour shading under the curves illustrate whether the heart cycle is in systole (blue), or diastole (red). In this work one specific strain value will be tested as input data for classification models, the value that is extracted is the trough of the strain curve during the systole. This extracted strain value will be referred to as \textit{peak systolic strain}.

\begin{figure}[H]
    \centering
    \input{echocardiography/pss_illustration_plt.pgf}
    \caption{Example of a longitudinal strain curve. Red dots indicate peak and trough values, and the shading below the curves indicate whether the heart cycle is in systole (blue) or diastole (red). The blue dots indicate the peaks and troughs in strain during systole, and the red dots illustrate the peaks and troughs in strain during diastole.}
    \label{fig:pss_illustration}
\end{figure}

The \acrfull{ef} of the left ventricle is is a parameter that is well established as an indicator of heart failure \cite{myocardial_imaging}. Similar to segment strain \acrshort{ef} is a relative measure, it is the relative difference in volume of the left ventricle when it is fully relaxed, and when it is fully contracted. \acrshort{ef} is numerically computed using the two dimensional intersectinal images of the three ultrasonic views provided by transthoracic echocardiography, and the algorithm used that is regarded as one of the most accurate method is called the Biplane method \cite{myocardial_imaging} or Biplane Simpson method.
\cite{myocardial_defomation_analysis} \textcite{myocardial_imaging} state that \acrshort{ef} values below $45\%$ are regarded as abnormal, and should warrant further inspection of a patient with regard to the possibility of heart failure.

\section{Heart Failure and Myocardial Infarction}
\begin{comment}
[ ] Explain the different diagnosises that will be encountered in this thesis.
[ ] Explain anatomical reasoning for why symptoms for certain diagnosis are evident in strain curves.
\end{comment}

Heart failure is the term used to describe when the heart muscle is unable to pump sufficient volumes of blood to the other muscles and organs in the body \cite{medicine_net}. So in a sense, heart failure can be considered as a degree of severity rather than a diagnosis. The heart diseases that are encountered in this work will mostly fall within the category of \textit{myocardial infarction}, which is also known as \textit{heart attack}. Myocardial infarction is encountered in two varieties \acrfull{stemi} and \acrfull{nstemi}. \acrshort{stemi} gets its name from the elevation of the ST segment of an electrocardiogram of a patient, which is a test performed on patients suspected of experiencing myocardial infarction \cite{ecg_stemi}. \acrshort{nstemi} then gets its name from the fact that the ST segment is not elevated in an electrocardiogram. \acrshort{stemi} is associated with a full blockage in one of the arteries supplying the heart with blood, and \acrshort{nstemi} is often associated with a partial blockage in one or several coronary arteries \cite{ambulanseforum}. Therefore, in many cases the \acrshort{nstemi} diagnosis does not require the same acute medical treatment that the \acrshort{stemi} diagnosis does. The heart diseases encountered that do not fall within the \acrshort{stemi} or \acrshort{nstemi} categories, were not given a specific label and are hence labelled as OTHER. \bigskip

One of the issues with using low \acrshort{ef} values to diagnose heart failure alone is that there is a significant subgroup that does not show low \acrshort{ef} values. Some patients that have heart diseases experience a growth in the muscle tissue around the heart, this is called \textit{hypertrophy}. The additional muscle reduces the absolute volume of the left ventricle. A reduced range of contraction will not be visible in the \acrshort{ef}, because the volume of the relaxed heart muscle is also reduced. When heart failure occurs, without being evident in the \acrshort{ef} values it is referred to as \acrshort{hfpef}. \bigskip

Reduced blood supply to parts of the heart muscle is also visible in ultrasound images, specifically in the range of motion of the specific regional segments. The reduction in blood supply will over time damage the myocardial tissue of the segment, this is evident by the reduced range of motion of the segment. Different segments are given \textit{segment indications} based on how good the ''quality'' of the range of motion of a segment is. The different labels of interest are \textit{normal}, if the range of motion of a segment looks normal, \textit{hyperkinetic} if the range of motion is increased and \textit{hypokinetic}, \textit{dyskinetic} and \textit{akinetic} are labels used for segments that show reduced ranges of motion. Section \ref{sec:target} will explore whether these attributes can be seen in the \acrshort{rls} curves.

Wall motion score is a visual measure of the transmural strain of the myocard segments, and can also be an indication of the degree of dysfunction of a particular segment \cite{strain_rate_imaging}. Wall motion scores are given as specific labels which are given here in descending order of severity: dyskinetic, akinetic, hypokinetic and normal. While the labels mentioned so far are used to indicate decreased transmural strain of segments, the label ''hyperkinetic" has been used to indicate increased transmural strain, and the label ''aneurysmal'' has been used. It is not entirely clear as to what aneurysmal is meant to indicate, but it could possibly stem from the word ''aneurysm'' which means dilation of an artery \cite{medic_net_aneurysm}. The collective term that will be used for these labels throughout this work is \textit{segment indication} since terms outside the regular wall motions scores are used.

\section{Chapter Summary}

In this chapter the basic structure of the heart muscle is detailed, the technology behind ultrasound imaging and echocardiography is introduced, the estimation of longitudinal strain curves, and \acrshort{ef} is explained and the definition of the different heart diseases enountered in this work are given. The heart is made up of two atria (left and right) and two ventricles (left and right), the right atrium and ventricle are responsible for pumping unoxygenated blood into the lungs, and the left atrium and ventricle are responsible for pumping oxygenated blood from the lungs into the rest of the body. B-mode ultrasound images are made by transmitting pulses of ultrasound waves, which are reflected by myocardial tissue and are sampled at the receiver. transthoracic echocardiography is a method of echocardiography used to obtain ultrasound images of the heart. It is performed by placing the transmitter/receiver at the ribs of a patient, and provides three intersectional images of the heart \acrshort{4ch}, \acrshort{2ch} and \acrshort{aplax}. Strain of the different segments of the left ventricle is estimated by drawing the boundaries of the segments using ECHOPAC, and calculating strain using equation \eqref{eq:linear_strain}. \acrshort{ef} is the measure of relative difference in volume of a fully relaxed left ventricle heart mucle, and a fully contracted one. The most common heart diseases encountered in this work are \acrshort{stemi}, and \acrshort{nstemi}, any other diseases were not labelled in the dataset, and will hence be labelled as OTHER. Segment indication is the collective term used for the labels of wall motion scores that are visual measures of transmural strain of segments, as well as the labels hyperkinetic and aneurysmal.